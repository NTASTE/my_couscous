<!DOCTYPE html>
<html lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta http-equiv="Content-Language" content="zh-cn">
	<meta name="keywords" content="文档手册">
	<meta name="description" content="写文档从此快乐">

	<title>文档生成器</title>

	<link rel="stylesheet" type="text/css" href="/css/bootstrap.min.css">
	<link rel="stylesheet" type="text/css" href="/css/detail.css">
	<!-- <link rel="stylesheet" type="text/css" href="/css/markdownbody.css"> -->
	<link rel="stylesheet" type="text/css" href="/css/github-markdown.css">

</head>

<body>
	<header class="detail-headfix">
		<nav class="w-1000 clearfix">
			<a href="" class="head-logo" target="_blank">
				<h2 style="font-size:28px;">
					文档生成器
				<!-- <img src="/images/logo.png" class="jklogo" > -->
			</h2>
			</a>
			<ul class="head-catalog">
									<li class="head-catalog-list ">
						<a href="/index.html">
							首页
						</a>
					</li>
									<li class="head-catalog-list ">
						<a href="/./docs/intro/desc.html">
							wiki
						</a>
					</li>
							</ul>
		</nav>
	</header>

	<div class="detail-wrapper w-1000  clearfix">
		<div class="detail-left">
			<ul class="detail-nav">
									<li class="detail-navlist navlist-one ">
						<div class="detail-navlist-title">
															<a href="/./docs/intro/desc.html">
									简介
								</a>
							
													</div>
											</li>
									<li class="detail-navlist navlist-one ">
						<div class="detail-navlist-title">
															<a href="#">
									数据接口
								</a>
							
															<div class="navlist-more more-one nav-down"></div>
													</div>
												<ul class="navul-one ">
														<li class="detail-navlist ">
								<div class="detail-navlist-title title-two ">
									<a href="/./docs/intro/api.html">
										调用须知
									</a>
								</div>
							</li>
														<li class="detail-navlist ">
								<div class="detail-navlist-title title-two ">
									<a href="/./docs/intro/boardlist.html">
										榜单列表
									</a>
								</div>
							</li>
														<li class="detail-navlist ">
								<div class="detail-navlist-title title-two ">
									<a href="/./docs/intro/board.html">
										榜单接口
									</a>
								</div>
							</li>
														<li class="detail-navlist ">
								<div class="detail-navlist-title title-two ">
									<a href="/./docs/intro/catelist.html">
										分类列表
									</a>
								</div>
							</li>
														<li class="detail-navlist ">
								<div class="detail-navlist-title title-two ">
									<a href="/./docs/intro/cate.html">
										分类接口
									</a>
								</div>
							</li>
														<li class="detail-navlist ">
								<div class="detail-navlist-title title-two ">
									<a href="/./docs/intro/update.html">
										更新接口
									</a>
								</div>
							</li>
														<li class="detail-navlist ">
								<div class="detail-navlist-title title-two ">
									<a href="/./docs/intro/search.html">
										检索接口
									</a>
								</div>
							</li>
														<li class="detail-navlist ">
								<div class="detail-navlist-title title-two ">
									<a href="/./docs/intro/rec.html">
										推荐接口
									</a>
								</div>
							</li>
														<li class="detail-navlist ">
								<div class="detail-navlist-title title-two ">
									<a href="/./docs/intro/content.html">
										内容接口
									</a>
								</div>
							</li>
														<li class="detail-navlist ">
								<div class="detail-navlist-title title-two ">
									<a href="/./docs/intro/sug.html">
										内容建议
									</a>
								</div>
							</li>
														<li class="detail-navlist ">
								<div class="detail-navlist-title title-two ">
									<a href="/./docs/intro/privilege.html">
										特权接口
									</a>
								</div>
							</li>
														<li class="detail-navlist ">
								<div class="detail-navlist-title title-two ">
									<a href="/./docs/intro/topiclist.html">
										专题列表
									</a>
								</div>
							</li>
														<li class="detail-navlist ">
								<div class="detail-navlist-title title-two ">
									<a href="/./docs/intro/topic.html">
										专题接口
									</a>
								</div>
							</li>
														<li class="detail-navlist ">
								<div class="detail-navlist-title title-two ">
									<a href="/./docs/intro/redirect.html">
										下载接口
									</a>
								</div>
							</li>
														<li class="detail-navlist ">
								<div class="detail-navlist-title title-two ">
									<a href="/./docs/intro/dlcallback.html">
										下载回调
									</a>
								</div>
							</li>
														<li class="detail-navlist ">
								<div class="detail-navlist-title title-two ">
									<a href="/./docs/intro/cpsdownload.html">
										CPS下载接口
									</a>
								</div>
							</li>
													</ul>
											</li>
									<li class="detail-navlist navlist-one ">
						<div class="detail-navlist-title">
															<a href="#">
									附录
								</a>
							
															<div class="navlist-more more-one nav-down"></div>
													</div>
												<ul class="navul-one ">
														<li class="detail-navlist ">
								<div class="detail-navlist-title title-two ">
									<a href="/./docs/intro/extrainfo1.html">
										附录1- signmd5
									</a>
								</div>
							</li>
														<li class="detail-navlist navlist-active">
								<div class="detail-navlist-title title-two ">
									<a href="/./docs/intro/extrainfo2.html">
										附录2-数据加密
									</a>
								</div>
							</li>
														<li class="detail-navlist ">
								<div class="detail-navlist-title title-two ">
									<a href="/./docs/intro/extrainfo3.html">
										附录3-参数签名
									</a>
								</div>
							</li>
														<li class="detail-navlist ">
								<div class="detail-navlist-title title-two ">
									<a href="/./docs/intro/extrainfo4.html">
										附录4-字段对照
									</a>
								</div>
							</li>
													</ul>
											</li>
									<li class="detail-navlist navlist-one ">
						<div class="detail-navlist-title">
															<a href="/./docs/intro/question.html">
									常见问题
								</a>
							
													</div>
											</li>
									<li class="detail-navlist navlist-one ">
						<div class="detail-navlist-title">
															<a href="/./docs/intro/about.html">
									联系我们
								</a>
							
													</div>
											</li>
							</ul>
		</div>

		<div class="detail-main">
			<div class="markdown-body">
				<h3 id="">数据加密算法</h3>
<hr />
<p>为保证用户隐私数据，需要对用户提交的敏感数据进行加密处理，说明如下：</p>
<ol>
<li>获取AES加密需要的key。将渠道号与密钥（API平台提供）拼接，然后获取拼接生成字符串的md5值并取后16位，最后将截取后的结果全部转为大写。</li>
<li>处理AES加密需要的iv值。iv向API平台申请即可，如果申请到的iv值不足16位，需要用字符“0”补足。</li>
<li>填充原文数据。具体算法见示例。</li>
<li>AES加密模式为CBC，实现算法为RIJNDAEL算法。具体初始化方式见示例。</li>
<li>生成的密文需要进行base64编码处理，并进行urlencode。</li>
</ol>
<p>Java示例程序(要求jdk1.8):</p>
<pre><code class="language-java">/*
 * Copyright (C) 2015 Baidu Inc. All rights reserved.
 */
package com.baidu.example;

import java.io.UnsupportedEncodingException;
import java.net.URLEncoder;
import java.security.InvalidAlgorithmParameterException;
import java.security.InvalidKeyException;
import java.security.MessageDigest;
import java.security.NoSuchAlgorithmException;
import java.util.Arrays;
import java.util.Base64;

import javax.crypto.BadPaddingException;
import javax.crypto.Cipher;
import javax.crypto.IllegalBlockSizeException;
import javax.crypto.NoSuchPaddingException;
import javax.crypto.spec.IvParameterSpec;
import javax.crypto.spec.SecretKeySpec;

/**
 *
 * @author yuanxingzhong
 * @since 2015年12月16日
 */
public final class AESUtility {

    /**
     * 加密，先aes，再base64再urlencode
     * @param rawStr
     * @param key
     * @param iv
     * @return
     */
    public static String encode(String rawStr, String from, String key, String iv) {
        if (null == rawStr || null == key || rawStr.isEmpty() || key.isEmpty()) {
            System.err.println("加密的必要参数为空，加密失败！");
            return null;
        }
        byte[] aesBytes = AESEncode(rawStr, from, key, iv);
        if (null == aesBytes) {
            System.err.println("aes加密失败");
            return null;
        }

        String base64Encode = Base64.getEncoder().encodeToString(aesBytes);

        String urlEncodeStr =  URLEncoder.encode(base64Encode);

        return urlEncodeStr;
    }

    /**
     * 对字符串进行aes加密
     * @param rawStr
     * @param key
     * @param iv
     * @return
     */
    private static byte[] AESEncode(String rawStr, String from, String key, String iv) {
        try {
            IvParameterSpec ivParam = null;
            if (null != iv &amp;&amp; !iv.isEmpty()) {
                ivParam = new IvParameterSpec(generateIV(iv));
            }

            String strMd5 = toMd5(from + key);
            if (null == strMd5) {
                System.err.println("生成key失败！");
                return null;
            }
            byte[] strBytes = strMd5.getBytes("utf-8");

            SecretKeySpec cipherKey = new SecretKeySpec(strBytes, strBytes.length / 2, strBytes.length / 2, "AES");

            Cipher encodeCipher = Cipher.getInstance("AES/CBC/PKCS5Padding");
            if (null != ivParam) {
                encodeCipher.init(Cipher.ENCRYPT_MODE, cipherKey, ivParam);
            } else {
                encodeCipher.init(Cipher.ENCRYPT_MODE, cipherKey);
            }

            return encodeCipher.doFinal(rawStr.getBytes("utf-8"));

        } catch (NoSuchAlgorithmException e) {
            e.printStackTrace();
        } catch (NoSuchPaddingException e) {
            e.printStackTrace();
        } catch (UnsupportedEncodingException e) {
            e.printStackTrace();
        } catch (InvalidKeyException e) {
            e.printStackTrace();
        } catch (InvalidAlgorithmParameterException e) {
            e.printStackTrace();
        } catch (IllegalBlockSizeException e) {
            e.printStackTrace();
        } catch (BadPaddingException e) {
            e.printStackTrace();
        }
        return null;
    }

    public static byte[] generateIV(String iv) {
        if (null == iv || iv.isEmpty()) {
            return null;
        }
        try {
            byte[] ivBytes = iv.getBytes("utf-8");
            return Arrays.copyOf(ivBytes, 16);
        } catch (UnsupportedEncodingException e) {
            e.printStackTrace();
        }
        return null;
    }

    /**
     * 获取字符串的md5
     * @param str
     * @return
     */
    public static String toMd5(String str){  
        try {  
            MessageDigest md5 = MessageDigest.getInstance("MD5");  
            byte[] bytes = md5.digest(str.getBytes("utf-8"));
            if (null != bytes) {
                return parseByte2HexStr(bytes);
            }
        } catch (NoSuchAlgorithmException e) {  
            e.printStackTrace();  
        } catch (UnsupportedEncodingException e) {
            e.printStackTrace();
        }
        return null;
    }

    /**
     * 将二进制转换成16进制
     * @param buf
     * @return
     */  
    public static String parseByte2HexStr(byte buf[]) {  
        if (null == buf) {
            return null;
        }
        StringBuffer sb = new StringBuffer();  
        for (int i = 0; i &lt; buf.length; i++) {  
            String hex = Integer.toHexString(buf[i] &amp; 0xFF);  
            if (hex.length() == 1) {  
                hex = '0' + hex;  
            }  
            sb.append(hex.toUpperCase());  
        }  
        return sb.toString();  
    }

}</code></pre>
<p>.net示例程序：</p>
<p>```.net
using System;
using System.Collections.Generic;
using System.IO;
using System.Linq;
using System.Runtime.InteropServices;
using System.Security.Cryptography;
using System.Text;
using System.Threading.Tasks;
using System.Web;</p>
<p>namespace YYGJ.CollectApp.Job.JobHelpers.Helper
{
public class BDAESUtility
{
/**</p>
<ul>
<li>加密，先aes，再base64再urlencode</li>
<li>@param rawStr</li>
<li>@param key</li>
<li>@param iv</li>
<li>
<p>@return
*/
public static string Encode(string rawStr, string key, string channel, string iv)
{
if (null == rawStr || null == key || string.IsNullOrEmpty(rawStr) || string.IsNullOrEmpty(key))
{
//加密的必要参数为空，加密失败！
return null;
}
byte[] aesBytes = AESEncode(rawStr, key, channel, iv);
if (null == aesBytes)
{
//aes加密失败
return null;
}</p>
<pre><code>    string base64Encode = Convert.ToBase64String(aesBytes, 0, aesBytes.Length);

    string urlEncodeStr = HttpUtility.UrlEncode(base64Encode, Encoding.UTF8);

    return urlEncodeStr;
}

/**
 * 对字符串进行aes加密
 * @param rawStr
 * @param key
 * @param iv
 * @return
 */
private static byte[] AESEncode(string rawStr, string key, string channel, string iv)
{
    if (string.IsNullOrEmpty(key) || string.IsNullOrEmpty(rawStr))
    {
        throw new Exception("加密key字符串是空或者加密字符串为空！");
    }
    string strMd5 = ToMd5(channel+key);

    strMd5 = strMd5.Substring(strMd5.Length - 16).ToUpper();

    if (null == strMd5)
    {
        return null;
    }
    byte[] bKey = Encoding.UTF8.GetBytes(strMd5);
    byte[] ivBytes = Encoding.UTF8.GetBytes(iv);
    byte[] bIV = ToByte(ivBytes, 16); ;
    byte[] bStr = Encoding.UTF8.GetBytes(rawStr);
    try
    {
        SymmetricAlgorithm desc = Aes.Create();
        desc.Mode = CipherMode.CBC;//CipherMode.CBC
        using (MemoryStream mStream = new MemoryStream())
        {
            using (CryptoStream cStream = new CryptoStream(mStream, desc.CreateEncryptor(bKey, bIV), CryptoStreamMode.Write))
            {
                cStream.Write(bStr, 0, bStr.Length);
                cStream.FlushFinalBlock();
                byte[] res = mStream.ToArray();
                return res;
            }
        }
    }
    catch
    {
        return null;
    }
}

/// &lt;summary&gt;
/// 把任意类型数据按字节读取到byte[]
/// &lt;/summary&gt;
/// &lt;param name="sIn"&gt;该类型的一个实例&lt;/param&gt;
/// &lt;param name="nLen"&gt;该类型的长度&lt;/param&gt;
/// &lt;returns&gt;字节流&lt;/returns&gt;
public static byte[] ToByte(byte[] bytes, int nLen)
{
    IntPtr psIn = IntPtr.Zero;
    byte[] buffer = new byte[nLen];
    int length = bytes.Length;
    if (length &lt; 16)
    {
        for (int i = 0; i &lt; length; i++)
        {
            buffer[i] = bytes[i];
        }
        for (int i = length; i &lt; 16; i++)
        {
            buffer[i] = 0;
        }
        return buffer;
    }
    return bytes;
}
//将字节流转成指定类型
public static object ToObject(byte[] rawdatas, Type anytype)
{
    int rawsize = Marshal.SizeOf(anytype);
    if (rawsize &gt; rawdatas.Length) return null;
    IntPtr buffer = Marshal.AllocHGlobal(rawsize);//分配指定大小的内存,返回一个指针
    Marshal.Copy(rawdatas, 0, buffer, rawsize);
    object retobj = Marshal.PtrToStructure(buffer, anytype);
    Marshal.FreeHGlobal(buffer);
    return retobj;
}

public static byte[] GenerateIV(string iv)
{
    if (null == iv || string.IsNullOrEmpty(iv))
    {
        return null;
    }
    try
    {
        byte[] ivBytes = Encoding.UTF8.GetBytes(iv);
        return ToByte(ivBytes, 16);
    }
    catch (Exception e)
    {
        return null;
    }
}

/**
 * 获取字符串的md5
 * @param str
 * @return
 */
public static string ToMd5(string str)
{
    try
    {
        using (MD5 md5 = MD5.Create())
        {
            byte[] bytes = Encoding.UTF8.GetBytes(str);
            bytes = md5.ComputeHash(bytes);
            if (null != bytes)
            {
                return ParseByte2HexStr(bytes);
            }
        }
    }
    catch (Exception e)
    {
        return e.StackTrace;
    }
    return null;
}

/**
 * 将二进制转换成16进制
 * @param buf
 * @return
 */
public static String ParseByte2HexStr(byte[] bytes)
{
    string hexString = string.Empty;
    if (bytes != null)
    {
        StringBuilder strB = new StringBuilder();

        for (int i = 0; i &lt; bytes.Length; i++)
        {
            strB.Append(bytes[i].ToString("X2"));
        }
        hexString = strB.ToString();
    }
    return hexString;
}</code></pre>
<p>}
}</p>
<pre><code>
PHP示例程序：</code></pre>
</li>
</ul>
<pre><code class="language-php">/*
 * Copyright (C) 2015 Baidu Inc. All rights reserved.
 */
class CryptAES {
    /**
     * @brief 加密
     *
     * @param $usData 需要加密的明文
     * @param $from   渠道标示
     * @param $secret secret
     * @param $iv     iv
     *
     * @return string
     */
    public static function encode($usData, $from, $secret, $iv) {
        if (!self::_validParams($from, $secret, $iv)) {
            return false;
        }

        list($key, $iv) = self::_init($from, $secret, $iv);
        $usData         = self::pad($usData);
        $enmcrypt       = mcrypt_module_open(MCRYPT_RIJNDAEL_128, '', MCRYPT_MODE_CBC, '');
        mcrypt_generic_init($enmcrypt, $key, $iv);

        // 加密
        $data = mcrypt_generic($enmcrypt, $usData);
        $data = urlencode(base64_encode($data));
        mcrypt_generic_deinit($enmcrypt);
        mcrypt_module_close($enmcrypt);

        return $data;
    }

    /**
     * @brief 解密
     *
     * @param $usData 需要解密的密文
     * @param $from   渠道标示
     * @param $secret secret
     * @param $iv     iv
     *
     * @return string
     */
    public static function decode($usData, $from, $secret, $iv) {
        if (empty($usData) || !self::_validParams($from, $secret, $iv)) {
            return false;
        }

        list($key, $iv) = self::_init($from, $secret, $iv);
        $usData         = base64_decode(urldecode($usData));
        $enmcrypt       = mcrypt_module_open(MCRYPT_RIJNDAEL_128, '', MCRYPT_MODE_CBC, '');
        mcrypt_generic_init($enmcrypt, $key, $iv);
        $data = mdecrypt_generic($enmcrypt, $usData);
        mcrypt_generic_deinit($enmcrypt);
        mcrypt_module_close($enmcrypt);
        return self::unpad($data);
    }

    /**
     * @brief 初始化加密参数
     *
     * @param $from
     * @param $secret
     * @param $iv
     *
     * @return
     */
    private static function _init($from, $secret, $iv) {
        // 获取加密key
        $key = strtoupper(substr(md5($from . $secret), -16));
        // 如果iv长度不足16字节，进行补足
        $iv  = str_pad(substr($iv, 0, 16), 16, chr(0));

        return array($key, $iv);
    }

    /**
     * @brief 验参
     *
     * @param $from
     * @param $secret
     * @param $iv
     *
     * @return
     */
    private static function _validParams($from, $secret, $iv) {
        if (empty($from) || empty($secret) || empty($iv)) {
            return false;
        }
        return true;
    }
    /**
     * @brief pkcs 填充
     *
     * @param $text string
     *
     * @return string
     */
    public static function pad($text) {
        $blocksize = 16;
        $pad       = $blocksize - (strlen($text) % $blocksize);
        return $text . str_repeat(chr($pad), $pad);
    }

    /**
     * @brief 解pkcs
     *
     * @param $text string
     *
     * @return string
     */
    public static function unpad($text) {
        $pad = ord($text{strlen($text) - 1});
        if ($pad &gt; strlen($text)) return false;
        if (strspn($text, chr($pad), strlen($text) - $pad) != $pad) return false;
        return substr($text, 0, -1 * $pad);
    }
}</code></pre>
<h5 id="-1">示例</h5>
<h6 id="imei">imei原文：</h6>
<p>1231414124131231</p>
<h6 id="iv">渠道号、密钥及iv：</h6>
<p>渠道号：testiD
密钥：testiD
iv：12345678</p>
<h6 id="-2">密文：</h6>
<p>oHYCp0y3sur6VerprhWrjFParjYcUZkIUpVsqQEpPTU%3D</p>
			</div>

			<div class="wiki-right">
				<div class="backtotop">
					<a href="javascript:;" class="btn-backtotop" style="">
						<div class="arrow"></div>
						<div class="stick"></div>
					</a>
				</div>
			</div>
			<div class="previous-and-next mg-t20">
				&nbsp;
			</div>
		</div>

	</div>
	<script type="text/javascript" src="/js/jquery.min.js"></script>
	<script type="text/javascript" src="/js/detail.js"></script>
        <!-- Livereload -->
        <script>
            document.write('<script src="http://' + (location.host || 'localhost').split(':')[0] +
                    ':35729/livereload.js?snipver=1"></' + 'script>')
        </script>
        <!-- End Livereload -->
    </body>
</html>
